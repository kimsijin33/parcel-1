#!/bin/bash

if [ ! -e $SNAP_DATA/tls-snakeoil-key ]; then
	echo -en "---\n\nsnakeoil_private_password: " > $SNAP_DATA/tls-snakeoil-key
	tr -cd '[:alnum:]' < /dev/urandom | fold -w128 | head -n1 >> $SNAP_DATA/tls-snakeoil-key
fi

if ls /var/snap/lxd/common/lxd 2>&1 > /dev/null; then
	touch $SNAP_DATA/has-lxd-socket-access
else
	if [ -e $SNAP_DATA/has-lxd-socket-access ]; then
		rm $SNAP_DATA/has-lxd-socket-access
	fi
fi

touch $SNAP_DATA/do-provision

# www loads a few variables on start
snapctl restart parcel.www
