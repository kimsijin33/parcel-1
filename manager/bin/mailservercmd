#!/bin/bash

IPV4=$(curl -s 'https://api.ipify.org?format=text')
IPV6=$(curl -s 'https://api6.ipify.org?format=text')

USERNAME="$(snapctl get haproxy-username)"
PASSWORD="$(snapctl get haproxy-password)"

if [ -e $SNAP_DATA/do-provision ]; then
  echo "The provision tasks on the server is running, please give"
  echo "the it a minute to get ready fully ready."
  echo
fi

echo "Instructions and configurations is found in the web interface."
echo "Visit it on port 8080 to configure it, the username and password"
echo "is set to ${USERNAME:-admin} and ${PASSWORD:-password}."
echo
echo "If you prefer the cli, type \"sudo snap get mailserver\" to list"
echo "all options and then do a \"sudo snap set mailserver foo=bar\"."
echo
echo " - http://$IPV4:8080"
if [[ $IPV4 != $IPV6 ]]; then
  echo " - http://$IPv6:8080"
fi
echo " - http://127.0.0.1:8080"
echo " - http://$(hostname -f):8080"
